import org.apereo.portal.start.gradle.plugins.GradleImportExportPlugin
import org.apereo.portal.start.gradle.plugins.GradlePlutoPlugin

apply plugin: GradleImportExportPlugin
apply plugin: GradlePlutoPlugin

dependencies {
    runtime "org.jasig.portlet:Announcements:${announcementsPortletVersion}@war"
    compile configurations.jdbc
}

war {
    archiveName 'Announcements.war'
    exclude 'WEB-INF/lib/hsqldb-*.jar'
}

/*
 * Import/Export Support
 */

ext {
    defaultEntitiesLocation = "${rootProject.projectDir}/data/quickstart/announcements"
}

dependencies {
    impexp configurations.jdbc
    impexp "${servletApiDependency}"
}

dataInit {
    dependsOn ':loadBuildProps'
    /*
     * Drop (if present) then create the Hibernate-managed schema.
     */
    doLast {
        ant.setLifecycleLogLevel('INFO')
        ant.java(fork: true, failonerror: true, dir: rootProject.projectDir, classname: 'org.jasig.portlet.announcements.SchemaCreator') {
            classpath {
                pathelement(location: "${project.buildDir}/${project.name}/WEB-INF/classes")
                pathelement(location: "${project.buildDir}/${project.name}/WEB-INF/lib/*")
                project.configurations.impexp.files.each {
                    pathelement(location: it.absolutePath)
                }
            }
            sysproperty(key: 'log4j.configuration', value: 'command-line.log4j.properties')
        }
    }
}
